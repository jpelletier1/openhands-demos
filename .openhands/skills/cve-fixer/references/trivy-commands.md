# Trivy Command Reference

## Installation Commands

### Linux

```bash
# Download Trivy binary
curl -sfL https://raw.githubusercontent.com/aquasecurity/trivy/main/contrib/install.sh | sh -s -- -b /usr/local/bin v0.56.0

# Or using apt
apt-get install trivy
```

### macOS

```bash
# Using Homebrew
brew install trivy

# Or binary
curl -sfL https://raw.githubusercontent.com/aquasecurity/trivy/main/contrib/install.sh | sh -s -- -b /usr/local/bin v0.56.0
```

### Docker

```bash
docker run aquasec/trivy:0.56.0 [command]
```

## File System Scanning

### Basic Commands

```bash
# Scan current directory
trivy fs .

# Scan specific directory
trivy fs /path/to/code

# Scan with vulnerability and config checks
trivy fs --security-checks vuln,config /path/to/code

# Scan only vulnerabilities
trivy fs --security-checks vuln /path/to/code

# Scan only config
trivy fs --security-checks config /path/to/code

# Scan for secrets
trivy fs --security-checks secrets /path/to/code
```

### Output Options

```bash
# JSON output
trivy fs --format json --output results.json /path/to/code

# SARIF output (for CI/CD)
trivy fs --format sarif --output results.sarif /path/to/code

# Table output (default)
trivy fs --format table /path/to/code

# CycloneDX output (SBOM)
trivy fs --format cyclonedx --output sbom.xml /path/to/code

# SPDX output (SBOM)
trivy fs --format spdx --output sbom.spdx /path/to/code
```

### Severity Filtering

```bash
# Show only CRITICAL and HIGH
trivy fs --severity CRITICAL,HIGH /path/to/code

# Show CRITICAL, HIGH, and MEDIUM
trivy fs --severity CRITICAL,HIGH,MEDIUM /path/to/code

# Show all severities
trivy fs --severity UNKNOWN,LOW,MEDIUM,HIGH,CRITICAL /path/to/code
```

### Ignore Rules

```bash
# Use custom policy directory
trivy fs --policy ./policy /path/to/code

# Use .trivyignore file
trivy fs /path/to/code

# Skip files/directories
trivy fs --skip-dirs node_modules --skip-dirs vendor /path/to/code

# Skip files
trivy fs --skip-files "*.test.go" /path/to/code
```

## Container Image Scanning

```bash
# Scan image
trivy image myimage:latest

# Scan and download only
trivy image --download-db-only myimage:latest

# Scan with registry authentication
trivy image --username user --password pass registry.example.com/image:tag

# Scan multiple images
trivy image image1:latest image2:latest

# Output in JSON
trivy image --format json myimage:latest
```

## Config Scanning

```bash
# Scan Dockerfiles
trivy config /path/to/dockerfile

# Scan Kubernetes manifests
trivy config /path/to/manifests/

# Scan Terraform files
trivy config /path/to/terraform/

# Scan CloudFormation
trivy config /path/to/cloudformation/

# Scan Helm charts
trivy config /path/to/helm/
```

## Database Management

```bash
# Update vulnerability database
trivy db --update

# Download database only (offline mode)
trivy db --download-db-only

# Show database information
trivy db --version
```

## Policy Commands

```bash
# Initialize OPA policy
trivy init

# Run with custom policies
trivy fs --policy ./policy --data ./policy/data /path/to/code

# List built-in policies
trivy policy lib
```

## Remediation

```bash
# Show fixable vulnerabilities
trivy fs --fix /path/to/code

# Generate patch for fixes
trivy fs --fix --fix-filters "kind:require" /path/to/code
```

## Miscellaneous

```bash
# Show version
trivy version

# Show help
trivy --help

# Debug mode
trivy --debug fs /path/to/code

# Cache directory
trivy --cache-dir /path/to/cache fs /path/to/code
```

## Exit Codes

- `0`: No vulnerabilities found
- `1`: Vulnerabilities found
- `2`: Error
- `3`: Unknown

## Common Workflows

### Quick Security Scan

```bash
trivy fs --severity HIGH,CRITICAL --exit-code 1 /path/to/code
```

### Full Security Audit

```bash
trivy fs --security-checks vuln,config,secrets \
  --severity UNKNOWN,LOW,MEDIUM,HIGH,CRITICAL \
  --format json --output audit.json \
  /path/to/code
```

### CI/CD Pipeline

```bash
trivy fs --exit-code 1 --severity HIGH,CRITICAL \
  --format sarif --output results.sarif \
  /path/to/code
```
