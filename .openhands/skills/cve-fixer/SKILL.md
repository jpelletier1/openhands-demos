---
name: cve-fixer
description: This skill should be used when the user asks to "fix CVEs", "scan for vulnerabilities", "run security scan", "vulnerability assessment", "fix security issues", or "CVE remediation". It provides workflows for downloading and running Trivy to identify and fix security vulnerabilities in applications.
---

# CVE Fixer

This skill provides workflows for identifying and fixing Common Vulnerabilities and Exposures (CVEs) in applications using Trivy security scanning.

## Core Workflow

### Step 1: Install Trivy

Install Trivy using the appropriate method for the environment:

```bash
# Download Trivy binary (Linux/macOS)
curl -sfL https://raw.githubusercontent.com/aquasecurity/trivy/main/contrib/install.sh | sh -s -- -b /usr/local/bin v0.56.0

# Or use Docker
docker run aquasec/trivy:0.56.0 --version
```

### Step 2: Scan for CVEs

Run Trivy against the code directory to generate a vulnerability report:

```bash
# Scan a directory for vulnerabilities
trivy fs --security-checks vuln,config /path/to/code

# Scan with specific severity levels
trivy fs --severity HIGH,CRITICAL /path/to/code

# Output results in JSON format for parsing
trivy fs --format json --output /path/to/trivy-report.json /path/to/code

# Scan for config issues only
trivy config /path/to/code

# Scan container images (if applicable)
trivy image your-image-name
```

### Step 3: Analyze Results

Review the Trivy output to identify:
- Critical and High severity vulnerabilities
- Vulnerable package names and versions
- Fixed versions available
- CVE identifiers (e.g., CVE-2024-1234)

### Step 4: Fix Vulnerabilities (Manual Remediation)

**Important:** Do NOT use `trivy --fix`. The agent must perform manual remediation by updating dependencies and fixing code patterns.

For each vulnerability, apply the appropriate fix manually:

**Package Updates:**
```bash
# JavaScript/Node.js - update packages manually
npm install package-name@secure-version

# Or update all dependencies to latest safe versions
npm update

# Review and apply security fixes
npm audit fix
```

**Configuration Fixes:**
- Manually update insecure configurations flagged by Trivy
- Remove deprecated or vulnerable configurations  
- Apply security best practices

**Code Pattern Fixes:**
- Fix prototype pollution vulnerabilities in code
- Sanitize user inputs to prevent SSRF
- Update authentication/authorization logic

### Step 5: Re-scan

Run Trivy again to verify fixes:

```bash
trivy fs --security-checks vuln,config /path/to/code
```

## Common Vulnerability Types

### Dependency Vulnerabilities

Trivy detects vulnerable dependencies in:
- `package-lock.json` (npm)
- `requirements.txt` (pip)
- `go.sum` (Go)
- `pom.xml` (Maven)
- `Gemfile.lock` (Ruby)

Fix by updating to secure versions.

### Configuration Issues

Trivy flags misconfigurations in:
- Dockerfiles
- Kubernetes manifests
- Terraform files
- General config files

Fix by applying security best practices.

### Secret Detection

Trivy can detect exposed secrets:

```bash
trivy fs --security-checks secrets /path/to/code
```

## Output Formats

### JSON Output

Generate JSON output for programmatic processing:

```bash
trivy fs --format json --output trivy-results.json /path/to/code
```

### SARIF Output

Generate SARIF format for CI/CD integration:

```bash
trivy fs --format sarif --output trivy-results.sarif /path/to/code
```

### HTML Report

Generate HTML report for human review:

```bash
trivy html --output trivy-report.html trivy-results.json
```

## CI/CD Integration

Add Trivy to CI/CD pipelines:

```yaml
# Example GitHub Actions
- name: Run Trivy
  uses: aquasecurity/trivy-action@master
  with:
    scan-type: 'fs'
    scan-ref: '.'
    format: 'json'
    output: 'trivy-results.json'
```

## Ignoring False Positives

To exclude specific findings:

```bash
# Use .trivyignore file
echo "CVE-2024-1234" > .trivyignore
trivy fs /path/to/code
```

## Trivy Database

Update the Trivy vulnerability database:

```bash
trivy db --update
```

## Additional Resources

### Reference Files

- **`references/trivy-commands.md`** - Complete Trivy command reference
- **`references/vulnerability-types.md`** - Detailed vulnerability type documentation

### Scripts

- **`scripts/scan.sh`** - Automated scan workflow script (scanning only, no auto-fix)
- **`scripts/filter_cves.py`** - Filter and prioritize CVEs by severity
